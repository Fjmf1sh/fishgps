<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI GPS Assistant</title>
  <!-- Leaflet CSS (HTTPS for GitHub Pages) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-o9N1Hf99i8CeVGQLfWTlcEpLJY9RJCEyaQEVDnIKZGU=" crossorigin="" />
  <style>
    /* Basic page and layout styling */
    body { margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
    /* Map takes half the view height by default */
    #map { flex: 1 1 50%; min-height: 50vh; }
    /* Assistant UI container takes other half */
    #assistant { flex: 1 1 50%; display: flex; flex-direction: column; }
    /* Messages area scrolls if long */
    #messages { flex: 1 1 auto; padding: 10px; overflow-y: auto; }
    /* Input area layout */
    #inputArea { display: flex; }
    #userInput { flex: 1 1 auto; font-size: 1em; padding: 5px; }
    #sendButton { font-size: 1em; padding: 5px 10px; }
    /* Larger screens: side-by-side layout */
    @media (min-width: 768px) {
      body { flex-direction: row; }
      #map, #assistant { flex: 1 1 50%; height: 100vh; min-height: auto; }
    }
  </style>
</head>
<body>
<!-- Map container -->
<div id="map"></div>

<!-- Assistant UI container -->
<div id="assistant">
  <!-- Chat messages will appear here -->
  <div id="messages"></div>
  <!-- User input area -->
  <div id="inputArea">
    <input type="text" id="userInput" placeholder="Type a message..." />
    <button id="sendButton">Send</button>
  </div>
</div>

<!-- Leaflet JS (HTTPS for GitHub Pages) -->
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-QV8IWPjdr5A+TXFOohWyTh4zp1INvOc+nYG8Hv8Q5c8=" crossorigin=""></script>

<!-- Main JavaScript: Map initialization, geolocation, and chat assistant -->
<script>
  // Initialize the Leaflet map
  const map = L.map('map').setView([0, 0], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  }).addTo(map);

  // Add a marker for the user’s location (initialized at [0,0])
  const userMarker = L.marker([0, 0]).addTo(map);

  // Use Geolocation API to watch position and update the marker and map view
  if ('geolocation' in navigator) {
    navigator.geolocation.watchPosition(
            function(position) {
              const lat = position.coords.latitude;
              const lon = position.coords.longitude;
              // Update marker position
              userMarker.setLatLng([lat, lon]);
              // Center map on new position
              map.setView([lat, lon]);
            },
            function(error) {
              console.error('Geolocation error:', error);
            },
            { enableHighAccuracy: true, maximumAge: 10000, timeout: 5000 }
    );
  } else {
    console.warn('Geolocation is not available in this browser.');
  }

  // Helper function to add a message to the chat window
  function addMessage(sender, text) {
    const messagesDiv = document.getElementById('messages');
    const messageElement = document.createElement('p');
    messageElement.innerHTML = `<strong>${sender}:</strong> ${text}`;
    messagesDiv.appendChild(messageElement);
    // Auto-scroll to bottom
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  // Async function to get assistant response from OpenAI API (ChatGPT)
  async function getAssistantResponse(userText) {
    try {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer YOUR_OPENAI_API_KEY'  // ← PUT your API key here
        },
        body: JSON.stringify({
          model: 'gpt-3.5-turbo',
          messages: [
            { role: 'user', content: userText }
          ]
        })
      });
      if (!response.ok) {
        throw new Error('Network response was not ok');
      }
      const data = await response.json();
      const assistantText = data.choices[0].message.content;
      addMessage('Assistant', assistantText);
    } catch (err) {
      console.error('Error fetching assistant response:', err);
    }
  }

  // Event listener for the Send button
  const sendButton = document.getElementById('sendButton');
  const userInput  = document.getElementById('userInput');
  sendButton.addEventListener('click', function() {
    const text = userInput.value.trim();
    if (!text) return;  // do nothing if input is empty
    // Display the user's message
    addMessage('User', text);
    userInput.value = '';  // clear the input
    // Get assistant response
    getAssistantResponse(text);
  });

  // Allow pressing Enter key to send the message
  userInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      sendButton.click();
    }
  });
</script>
</body>
</html>
